---
phase: 01-allowlist-cleanup-and-fallback-fix
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - fin_evo_agent/src/core/executor.py
  - fin_evo_agent/src/core/llm_adapter.py
autonomous: true

must_haves:
  truths:
    - "Running `python main.py --security-check` shows talib is NOT in ALLOWED_MODULES"
    - "SYSTEM_PROMPT in llm_adapter.py does not mention talib in the allowed imports list"
    - "Generated tools that try to import talib are blocked by AST security check"
  artifacts:
    - path: "fin_evo_agent/src/core/executor.py"
      provides: "ALLOWED_MODULES set without talib"
      contains: "ALLOWED_MODULES"
    - path: "fin_evo_agent/src/core/llm_adapter.py"
      provides: "SYSTEM_PROMPT without talib reference"
      contains: "SYSTEM_PROMPT"
  key_links:
    - from: "fin_evo_agent/src/core/llm_adapter.py"
      to: "fin_evo_agent/src/core/executor.py"
      via: "Both must agree on allowed modules"
      pattern: "pandas.*numpy.*datetime.*json.*math.*decimal.*collections.*re.*yfinance.*pathlib"
---

<objective>
Remove all references to `talib` from the codebase allowlists.

Purpose: The talib C library is not installed and will not be installed (per project decision). Removing it from allowlists prevents the LLM from generating tools that import talib, which would fail at runtime with ModuleNotFoundError.

Output: Two files edited - executor.py ALLOWED_MODULES set and llm_adapter.py SYSTEM_PROMPT string - both without talib.
</objective>

<execution_context>
@/home/node/.claude/get-shit-done/workflows/execute-plan.md
@/home/node/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-allowlist-cleanup-and-fallback-fix/01-RESEARCH.md

# Source files to modify
@fin_evo_agent/src/core/executor.py
@fin_evo_agent/src/core/llm_adapter.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove talib from ALLOWED_MODULES in executor.py</name>
  <files>fin_evo_agent/src/core/executor.py</files>
  <action>
Edit the ALLOWED_MODULES set (around line 48-53) to remove 'talib'.

BEFORE:
```python
ALLOWED_MODULES = {
    'pandas', 'numpy', 'datetime', 'json',
    'math', 'decimal', 'collections', 're',
    'yfinance', 'talib', 'typing', 'hashlib',
    'pathlib'
}
```

AFTER:
```python
ALLOWED_MODULES = {
    'pandas', 'numpy', 'datetime', 'json',
    'math', 'decimal', 'collections', 're',
    'yfinance', 'typing', 'hashlib',
    'pathlib'
}
```

This is a single-line edit: remove `'talib', ` from the set literal.
  </action>
  <verify>
```bash
cd /workspace/fin_evo_agent
python3 -c "from src.core.executor import ToolExecutor; assert 'talib' not in ToolExecutor.ALLOWED_MODULES, 'talib still in ALLOWED_MODULES'; print('PASS: talib removed from ALLOWED_MODULES')"
```
  </verify>
  <done>The string 'talib' does not appear in ToolExecutor.ALLOWED_MODULES set.</done>
</task>

<task type="auto">
  <name>Task 2: Remove talib from SYSTEM_PROMPT in llm_adapter.py</name>
  <files>fin_evo_agent/src/core/llm_adapter.py</files>
  <action>
Edit the SYSTEM_PROMPT string (line 23) to remove 'talib' from the allowed imports list.

BEFORE (line 23):
```python
3. Use only allowed imports: pandas, numpy, datetime, json, math, decimal, collections, re, yfinance, talib, pathlib
```

AFTER:
```python
3. Use only allowed imports: pandas, numpy, datetime, json, math, decimal, collections, re, yfinance, pathlib
```

This is a single edit: remove `, talib` from the imports list in the SYSTEM_PROMPT string.
  </action>
  <verify>
```bash
cd /workspace/fin_evo_agent
python3 -c "from src.core.llm_adapter import SYSTEM_PROMPT; assert 'talib' not in SYSTEM_PROMPT, 'talib still in SYSTEM_PROMPT'; print('PASS: talib removed from SYSTEM_PROMPT')"
```
  </verify>
  <done>The string 'talib' does not appear anywhere in the SYSTEM_PROMPT constant.</done>
</task>

<task type="auto">
  <name>Task 3: Verify security check output</name>
  <files></files>
  <action>
Run the security check command to confirm talib is no longer listed as an allowed module.

```bash
cd /workspace/fin_evo_agent
python3 main.py --security-check
```

The output should NOT include 'talib' in the allowed modules list.
  </action>
  <verify>
```bash
cd /workspace/fin_evo_agent
python3 main.py --security-check 2>&1 | grep -v talib && echo "PASS: talib not in security check output"
```
  </verify>
  <done>Running `python main.py --security-check` does not show talib in allowed modules.</done>
</task>

</tasks>

<verification>
All three verification commands must pass:

1. `python3 -c "from src.core.executor import ToolExecutor; assert 'talib' not in ToolExecutor.ALLOWED_MODULES"` - exits 0
2. `python3 -c "from src.core.llm_adapter import SYSTEM_PROMPT; assert 'talib' not in SYSTEM_PROMPT"` - exits 0
3. `python3 main.py --security-check` output does not contain 'talib'
</verification>

<success_criteria>
- PROMPT-01 satisfied: talib removed from SYSTEM_PROMPT
- PROMPT-02 satisfied: talib removed from ALLOWED_MODULES
- Both allowlists are consistent (same modules listed)
- Security check confirms the change
</success_criteria>

<output>
After completion, create `.planning/phases/01-allowlist-cleanup-and-fallback-fix/01-01-SUMMARY.md`
</output>
